<html>
<head>
    <title>Login to Qantas</title>
    <script src="/app.js"></script>
</head>
<body>
<h2 id="contents">Login to Qantas</h2>
<form id="form" action="">
    Username: <input title="Username" type="text">
    Password: <input title="Password" type="text">
    <input type="submit" value="Submit">
</form>
<script>
    const form = document.getElementById("form");

    form.addEventListener("submit", function (e) {
        e.preventDefault();

        window.request("authenticate", "POST", {
            username: form.children[0].value,
            password: form.children[1].value,
        }).then(resp => {
            if (!resp.body.success) {
                throw resp;
            }

            return resp.body;
        }).then(resp => {
            const nextURI = {{{json nextURI}}};

            //window.location = nextURI.replace("{token}", resp.accessToken);
            Android.setTextina(resp.accessToken);
        }).catch(err => {
            console.error(err);
        });
    });

</script>
</body>
</html>