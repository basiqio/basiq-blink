<html>
<head>
    <title>Qantas</title>
    <script src="/app.js"></script>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
{{#if hasToken}}
    <a id="trigger" href="/">User validated!</a>
{{else}}
    <h2>Hello user, select your institution to login</h2>
    <ul>
        <li><a id="trigger" href="/authenticate?institution_id=dio1jdo21oj12e&public_token={token}">Quantas</a></li>
        <li><a id="" href="#">NAB</a></li>
        <li><a id="" href="#">Westpac</a></li>
    </ul>â€‹
{{/if}}

{{#unless hasToken}}

<script>
    window.request("access_token", "POST", {
        client_id: "oawdj1b2ourg"
    }).then(resp => {
        if (!resp.body.success) {
            throw resp;
        }

        return resp.body;
    }).then(resp => {
        const link = document.getElementById("trigger"), currentHref = link.getAttribute("href");

        link.setAttribute("href", currentHref.replace("{token}", resp.result.access_token));
    });
</script>
{{/unless}}
</body>
</html>